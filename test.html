<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta name="generator" content="ussg" />
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>Setting up znc with a subdomain using NGINX - ht's website.</title>
		<link rel="icon" type="image/x-icon" href="/static/images/favicon/favicon.ico">
		<meta name="description" content="Quick tutorial on setting up ZNC - IRC bouncer with an nginx reverse proxy">
		<style>
@import url('/static/fonts/inter.css');
body{font-size:18px;font-family:'Inter', sans-serif;font-weight:500;color:#333;line-height:1.5;margin:0 auto;max-width:40em;padding:0 1em;background-color:#f7f7f7}input{filter: drop-shadow(0.30em 0.30em 0.0em rgb(0,0,0));margin:10px 0;width:95%;height:2em;font-family:monospace;font-weight:500}textarea{filter: drop-shadow(0.30em 0.30em 0.0em #000);margin:10px 0;width:95%;height:10em;font-weight:500}button{filter: drop-shadow(0.30em 0.30em 0.0em #000);margin:10px 0;background-color:white;height:3em;font-weight:500;font-family:monospace}main{word-wrap:break-word;word-break:normal;padding:10px;margin-bottom:5em}nav ul{word-wrap:break-word;word-break:normal;list-style-type:none;margin:0;padding:0}nav li{display:inline}header h1{color:black;text-decoration:none;padding:0 10px}footer{text-align:center}h1,h2,h3,h4,h5,h6{margin:1.25em 0 0.5em;line-height:1.2}nav a{font-weight:700;padding:0 4px;text-decoration:underline}a:link{color:#457ab7}a:visited{color:#7f79ce}a:focus,a:hover{color:#3c6593}a:active{text-decoration:underline}header a:link{color:black;text-decoration:none}header a:visited{color:black;text-decoration:none}header a:focus,header a:hover{color:black;text-decoration:none}header a:active{color:black;text-decoration:none}h1 a:empty:before,h2 a:empty:before,h3 a:empty:before,h4 a:empty:before,h5 a:empty:before,h6 a:empty:before{content:"#"}h1 a:empty,h2 a:empty,h3 a:empty,h4 a:empty,h5 a:empty,h6 a:empty{visibility:hidden;padding-left:0.25em}h1:hover a:empty,h2:hover a:empty,h3:hover a:empty,h4:hover a:empty,h5:hover a:empty,h6:hover a:empty{visibility:visible}img{max-width:100%}figure{margin:1em 0;text-align:center}figcaption{font-size:small}code,kbd,pre,samp{color:#ea4f41;font-family:monospace, monospace}pre kbd{color:#060}blockquote,pre{background:#eee;padding:0.5em}pre{overflow:auto}blockquote{font-style: italic; border-left:medium solid #ccc;margin:1em 0}blockquote:first-child{margin-top:0}blockquote:last-child{margin-bottom:0}table{border-collapse:collapse}td,th{border:thin solid #999;padding:0.3em 0.4em;text-align:left}@media (prefers-color-scheme: dark){body{font-size:18px;font-family:'Inter', sans-serif;font-weight:500;color:#eee;line-height:1.5;margin:0 auto;max-width:40em;padding:0 1em;background-color:#111e28}a:link{color:#91ccee}a:visited{color:#8daabb}a:focus,a:hover{color:#b0dffb}a:active{text-decoration:underline}code,kbd,pre,samp{color:#6cf}pre kbd{color:#9c6}blockquote,pre{background:#24323d}blockquote{border-color:#24323d}td,th{border-color:#666}button,input,textarea{filter: drop-shadow(0.30em 0.30em 0.0em #fff)}header a:active,header a:focus,header a:hover,header a:link,header a:visited{color:#eee;text-decoration:none}}#gallery{line-height:0;-webkit-column-count:3;-webkit-column-gap:5px;-moz-column-count:3;-moz-column-gap:5px;column-count:3;column-gap:5px}#gallery img{width:100% !important;height:auto !important;margin-bottom:5px}@media (max-width: 1200px){#gallery{-moz-column-count:3;-webkit-column-count:3;column-count:3}}@media (max-width: 1000px){#gallery{-moz-column-count:3;-webkit-column-count:3;column-count:3}}@media (max-width: 800px){#gallery{-moz-column-count:2;-webkit-column-count:2;column-count:2}}@media (max-width: 400px){#gallery{-moz-column-count:1;-webkit-column-count:1;column-count:1}}</style>

	</head>
	<body>
		<header>
			<h1><a href="/">ht.xyz</a></h1>
		</header>
		<main>
			<nav>
				<ul><li><a href='/'>home</a>&nbsp;</li><li><a href='/posts/projects'>projects</a>&nbsp;</li><li><a href='/posts/blog'>blog</a>&nbsp;</li><li><a href='/posts/artwork'>artwork</a>&nbsp;</li><li><a href='/posts/poems'>poetry</a>&nbsp;</li><li><a href='/posts/archive.html'>archives</a>&nbsp;</li></ul>
			</nav>
			<hr>
			<h3 id='articletitle'>Setting up znc with a subdomain using NGINX</h3>
			2022-06-10
			<hr>
<p>This post covers ubuntu/debian and systemd based operating systems. Although
minor differences may exist, similar principle can be applied to other systems
as well. Setting up znc on a linux machine is easy, and setting it up with a
subdomain is easy as well! We will be using a standard znc installation and use
certbot to generate SSL certificates.</p>

<h3>Requirements</h3>

<a href="https://wiki.znc.in/Installation">znc</a>
<a href="https://nginx.org/en/">nginx</a>
<a href="https://certbot.eff.org/">certbot</a>

<p>Install znc using any method explained on the <a href="https://wiki.znc.in/Installation">main site</a>.</p>

<p>If you are on ubuntu, you can install znc and nginx using</p>

<code>sudo apt install znc nginx certbot</code></p>

<h3>Configuration</h3>

<p>Once that is done, we need to create config file for znc. That can be done by</p>

<code>znc --makeconf</code></p>

<p>It will ask you multiple questions, here is how I answered them:</p>

<pre><code>   Listen on port: 1025    
   Listen using SSL: yes    
   Listen using both IPv4 and IPv6: no    
   Username: your_username    
   Enter password: your_password     
   Confirm password: your_password            
   Nick: nick     
   Alternate nick: nick_    
   Real name: optional    
   Bind host:    
   Set up a network? no    
   Launch ZNC now? no    
</code></pre>

<p>At this point znc has created your config file at</p>

<code>$HOME/.znc/configs/znc.conf</code>.
Now we modify the config so that there are two listeners instead of one. <strong>(Note how
one allows web interface while the other is for IRC, both on different
ports.)</strong> You will use the first one to modify znc settings and the second one
to access znc network via IRC.</p>

<pre><code>&lt;Listener listener0&gt;
    AllowIRC = false
    AllowWeb = true
    IPv4 = true
    IPv6 = false
    Port = 31337
    SSL = true
    URIPrefix = /
&lt;/Listener&gt;

&lt;Listener listener1&gt;
    AllowIRC = true
    AllowWeb = false
    IPv4 = true
    IPv6 = false
    Port = 1337
    SSL = true
    URIPrefix = /
&lt;/Listener&gt;
</code></pre>

<p>You can start znc by simply entering <code>znc</code>.</p>

<h3>Setting up reverse proxy</h3>

<p>All that is left now is to configure nginx so that it will pass the
subdomain requests to znc. Create the znc config file at
<code>/etc/nginx/sites-enabled/znc</code> <strong>Make sure your DNS record for selected subdomain point to the IP of your host.</strong></p>

<pre><code>server {
    server_name znc.yourdomain.xyz;
    access_log  /var/log/nginx/znc-access.log;
    error_log   /var/log/nginx/znc-error.log;

    location / {
        proxy_pass https://127.0.0.1:31337/;
    }
}
</code></pre>

<p>After this check for errors in the configuration:
<code>sudo nginx -t</code></p>

<p>Restart nginx service from systemd:
<code>sudo systemctl restart nginx</code></p>

<p>One last thing left to do is generate ssl certificates for the znc subdomain.
You can do that by using <code>certbot</code> command. Enter it and follow the
instructions to proceed.</p>

<p>Now your znc web interface should be accessible from <code>znc.yourdomain.xyz</code></p>
<form name="comments" id='formcomments' method='POST' action='/cgi-bin/addcomment.cgi'>
	<div><h3>Post Comment</h3></div>
	<div>
		<input type="text" class='comment-field' name="alias" placeholder="Your Alias"  id="alias" required />
		<input type="hidden" id='texturl'  name="url"/>
		<input type="hidden" id='textdate' name="time"/>
	</div>
	<div>
		<textarea maxlength=500 name="body" placeholder="Enter your comment here (Max 500 words)"  id="comment" required ></textarea>
	</div><div>    
		<button type="button" onclick="tesubmit()"  id="comment-button">Comment</button>
	</div>
</form>
<div id='solution' class='commentslist'></div>
<script src="/static/comments.js"></script>
<script>
	function tesubmit(){
		document.getElementById('texturl').setAttribute('value',window.location.pathname);
		document.getElementById('texturl').value = window.location.pathname;
		document.getElementById('textdate').setAttribute('value',new Date().toString());
		document.getElementById('formcomments').submit();
	}

	function displaycomments(){
		var url = window.location.pathname;
		var commentslist = document.getElementById("solution");
		commentslist.insertAdjacentHTML("beforeend","<h3>Comments ðŸ‘‡</h3>");
		for(let i=0;i<comments.length;i++){
			if(comments[i].url== url){
				var txt = `
				<hr>
				<div>
					<small>	<b>${comments[i].alias}</b>&nbsp;
						${comments[i].time}</small>
				<br>
				<div>
					${comments[i].body}				</div>
				<hr>
				</div>`;
				commentslist.insertAdjacentHTML("beforeend",txt);
			}
		}
	}
window.onload = displaycomments();
</script>
<footer>
	Copyright Â© 2022 - Hitarth Thummar | <a href="/rss.xml">Subscribe via RSS</a>
</footer>
</main>
</body>
</html>
